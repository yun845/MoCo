<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡Œå‹•æ•‘æ´é€šè¨Šå™¨</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        .sos-btn { 
            width: 100%; max-width: 300px; height: 150px; 
            font-size: 24px; font-weight: bold; color: white;
            background: #e74c3c; border: none; border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); cursor: pointer;
        }
        .sos-btn:active { background: #c0392b; transform: scale(0.98); }
        #log { margin-top: 30px; text-align: left; background: white; padding: 10px; border-radius: 10px; }
        .msg-item { border-bottom: 1px solid #ddd; padding: 10px 0; }
        .map-link { color: #3498db; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

    <h2>è¡Œå‹•ä½ç½®æ•‘æ´ç³»çµ±</h2>
    <p>é‡åˆ°ç·Šæ€¥ç‹€æ³æ™‚ï¼Œè«‹æŒ‰ä¸‹å¤§ç´…æŒ‰éˆ•</p>
    
    <button class="sos-btn" id="sendBtn">ç™¼é€æ•‘æ´è¨Šè™Ÿ<br>(åŒ…å« GPS åº§æ¨™)</button>

    <div id="log">
        <strong>å³æ™‚é€šè¨Šçœ‹æ¿ï¼š</strong>
        <div id="messageList"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const sendBtn = document.getElementById('sendBtn');
        const messageList = document.getElementById('messageList');

        sendBtn.onclick = () => {
            if (navigator.geolocation) {
                // é¡¯ç¤ºç²å–ä¸­ï¼Œå¢åŠ äº’å‹•æ„Ÿ
                sendBtn.innerText = "å®šä½ä¸­...";
                
                navigator.geolocation.getCurrentPosition((pos) => {
                    const payload = {
                        lat: pos.coords.latitude,
                        lng: pos.coords.longitude,
                        id: socket.id.substring(0, 5) // é¡¯ç¤ºéƒ¨åˆ† ID ä»£è¡¨ä¸åŒä½¿ç”¨è€…
                    };
                    socket.emit('sos', payload);
                    sendBtn.innerHTML = "ç™¼é€æ•‘æ´è¨Šè™Ÿ<br>(åŒ…å« GPS åº§æ¨™)";
                    alert("è¨Šè™Ÿå·²ç™¼å‡ºï¼");
                }, (err) => {
                    alert("ç„¡æ³•å–å¾—ä½ç½®ï¼Œè«‹é–‹å•Ÿ GPS");
                    sendBtn.innerHTML = "ç™¼é€æ•‘æ´è¨Šè™Ÿ<br>(åŒ…å« GPS åº§æ¨™)";
                });
            }
        };

        socket.on('receive_sos', (data) => {
            const div = document.createElement('div');
            div.className = 'msg-item';
            // å‰µæ–°é»ï¼šè‡ªå‹•ç”Ÿæˆ Google åœ°åœ–é€£çµ
            const mapUrl = `https://www.google.com/maps?q=${data.lat},${data.lng}`;
            div.innerHTML = `
                <b>[æ±‚æ•‘]</b> ä½¿ç”¨è€… ${data.id} <br>
                æ™‚é–“: ${data.serverTime} <br>
                åº§æ¨™: ${data.lat.toFixed(4)}, ${data.lng.toFixed(4)} <br>
                <a href="${mapUrl}" target="_blank" class="map-link">ğŸ“ åœ¨åœ°åœ–ä¸ŠæŸ¥çœ‹ä½ç½®</a>
            `;
            messageList.prepend(div); // æ–°è¨Šæ¯æ”¾åœ¨æœ€ä¸Šé¢
        });
    </script>
</body>
</html>
